version: "2"
services:
  selenium:
    image: selenium/standalone-chrome-debug
    volumes:
      - .:/opt/linotp/tests
    ports:
     - "5900"

  selenium_tester:
    image: selenium_tester
    build:
      context: ..
      dockerfile: Dockerfile.script-executor
      args:
        - http_proxy
        - https_proxy
        - no_proxy
        - DEBIAN_MIRROR=deb.debian.org
    environment:
      SELENIUM_DRIVER: "chrome"
      TEST_BUNCH: "integrationtests PYTESTARGS='-v'"
    volumes:
      - ..:/opt/linotp/tests:ro
    depends_on:
      - selenium
      - linotp

  linotp:
    image: linotp
    restart: always
    environment:
      LINOTP_DATABASE_URI: "mysql://linotpuser:linotppass@db/linotp_db?charset=utf8"
      LINOTP_DB_HOST: "db"
      LINOTP_DB_PORT: "3306"
      LINOTP_APACHE_AUTH: "false"
    depends_on: 
      - db
    ports:
      - "443"

  db:
    image: mysql:5.5
    environment:
      MYSQL_ROOT_PASSWORD: "Test123!"
      MYSQL_DATABASE: "linotp_db"
      MYSQL_USER: "linotpuser"
      MYSQL_PASSWORD: "linotppass"
    restart: always
